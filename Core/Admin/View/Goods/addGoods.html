<extend name="Common:base" />

<block name="cusStyle">
	<link rel="stylesheet" href="__PUBLIC__/Admin/js/kindeditor/themes/default/default.css" />
	<link rel="stylesheet" href="__PUBLIC__/Admin/css/webuploader.css">
	<style type="text/css">
		.stdbtn2 {padding: 0px 15px; height: auto; line-height: 32px; border: 1px solid #e4e4e4; background: #fff; color: #333; -moz-border-radius: 2px; -webkit-border-radius: 2px; border-radius: 2px; opacity: 1; margin-right: 3px; display: inline-block; vertical-align: middle; cursor: pointer;}
		.stdbtn2.on {border: 1px solid #967bdc;}
		.adddivs{height:50px;position: relative;margin:10px auto;text-align: center;}
		.adddivs .addinput{width: 50px; height: 50px; opacity: 0; display: inline-block;}
		.adddivs .cutIcon{position:absolute;width:12px;height:12px;display: block;left: -4px;top:-4px;background: url(__PUBLIC__/Admin/images/cus_close.png) no-repeat center center;background-size: 12px;cursor: pointer;cursor: pointer;display: block;}
		.adddivs .addinput-bg{width:50px;height:50px;display: inline-block;margin-left: 10px;background: url(/Static/Public/Admin/images/upload-bg.png) no-repeat center center;background-size: 48px;border:1px dashed #d5d5d5;}
		.adddivs .img-bg{position: relative;width:50px;height:50px;display: inline-block;}
		/*td {
			vertical-align:middle;
		}*/
		.Kreplay_m{width: 80%;height: auto;}
	</style>
</block>

<block name="menu">
	<include file="GoodsCat/menu" />
</block>

<block name="main">
<style type="text/css">
        .ke-icon-video {background: url("__PUBLIC__/Admin/images/video.png") no-repeat center center;background-size: cover;width: 16px;height: 16px;
        }
        .ke-icon-imageico {background: url("__PUBLIC__/Admin/images/image.png") no-repeat center center;background-size: cover;width: 16px;height: 16px;
        }
        .ke-icon-audio {background: url("__PUBLIC__/Admin/images/audio.png") no-repeat center center;background-size: cover;width: 16px;height: 16px;
        }
    </style>
<div class="pageheader">
    <h1 class="pagetitle">
    	新增商品
    </h1>
    <span class="pagedesc"></span>
</div>

<div id="contentwrapper" class="contentwrapper">
	<form class="stdform stdform2" id="KsubmitForm">
		<div class="line-dete">
			<label>商品分类</label>
	        <span class="field" id="goodsCategory">
	        	<select id="selectCategory">
	        		<option value="">请选择</option>
	    			<volist name="categoryData" id="category">
	        			<option value="{$category['id']}">{$category['category_name']}</option>
	    			</volist>
	        	</select>
	        </span>
		</div>

		<div class="line-dete">
			<label>商品状态</label>
	        <span class="field">
	        	<input type="radio" name="is_on_sale" value="1" checked>上架
	        	<br>
	        	<input type="radio" name="is_on_sale" value="0">下架
	        </span>
		</div>

		<div class="line-dete">
			<label>商品属性</label>
	        <span class="field">
	        	<input type="radio" name="goods_attr" value="0" checked>成品
	        	<br>
	        	<input type="radio" name="goods_attr" value="1">非标产品
	        </span>
		</div>

		<div class="line-dete">
			<label>是否支持退货</label>
	        <span class="field">
	        	<input type="radio" name="can_return" value="1" checked>支持
	        	<br>
	        	<input type="radio" name="can_return" value="0">不支持
	        </span>
		</div>

		<div class="line-dete">
			<label>是否支持上门安装</label>
	        <span class="field">
	        	<input type="radio" name="can_install" value="1" checked>支持
	        	<br>
	        	<input type="radio" name="can_install" value="0">不支持
	        	<input type="text" name="install_price" value="0">
	        	<span class="font-color">（元）上门安装费用，默认为0</span>
	        </span>
		</div>

		<div class="line-dete">
			<label>商品编码</label>
	        <span class="field">
	        	<input class="smallinput" type="text" name="goods_code" id="goods_code"/>
	        	<span class="font-color">*一旦设置不可修改</span>
	        </span>
		</div>
		
		
		<div class="line-dete">
			<label>商品名称</label>
	        <span class="field">
	        	<input class="smallinput" type="text" name="goods_name"/>
	        	<span class="font-color">*标题最多100个字符</span>
	        </span>
		</div>

		<div class="line-dete">
			<label>副标题</label>
	        <span class="field">
	        	<input class="smallinput" type="text" name="introduction"/>
				<span class="font-color">可为空，最多255个字符</span>
	        </span>
		</div>

		<div class="line-dete">
			<label>单位</label>
	        <span class="field">
	        	<input class="smallinput" type="text" name="unit"/>
	        </span>
		</div>

		<div class="line-dete">
			<label>排序数字</label>
	        <span class="field">
	        	<input class="smallinput" type="text" name="sort"/>
	        	<span class="font-color">*数字，越大越向前</span>
	        </span>
		</div>

		

		<div class="line-dete" id="JeditSKU">
			<label>
				商品型号<br>
				<input type="button" value="设置属性" id="Kattribute" />
			</label>
		</div>

		<div class="line-dete">
			<label>商品图片</label>
	        <div class="field">
				<div id="photoList" class="m-photo-list"></div>
				<div class="upload-wrap">
					<div id="filePicker" class="f-upload"></div>
	        	</div>
	        </div>
		</div>

		<div class="line-dete">
			<label>产品介绍</label>
	        <span class="field">
	        	<textarea class="text" name="description" id="content"></textarea>
	        </span>
		</div>
		<div class="line-dete">
			<label></label>
	        <span class="field">
	        	<input type="hidden" name="category_id" id="category_id">
	        	<input type="button" class="stdbtn Ksubmit" value="提交">
	        	<input type="button" class="stdbtn" value="返回上一页" onclick="window.history.go(-1)" />
	        </span>
		</div>
	</form>
</div>

<!-- 弹窗 -->
<div class="mask Kmask"></div>
<div class="replay_m Kreplay_m">
	<!-- <table>
	    <volist name="attrNameData" id="attrName">
	    	<tr>
	    		<td>{$attrName['attr_name']}</td>
	    		<td>
	    			<volist name="attrName['attrValueData']" id="attrValue">
	    				<div class="stdbtn2" data-attr="{$attrName['id']}" data-value="{$attrValue['id']}" data-attrname="{$attrName['attr_name']}">{$attrValue['attr_value']}</div>
	    			</volist>
	    		</td>
	    	</tr>
	    </volist>
	</table> -->
    
</div>
</block>

<block name="script">
<script type="text/html" id="attrData_tpl">
	<table>
	<%for(var i = 0; i < list.length; i++){
		var data = list[i];%>
		<tr>
			<td>
            	<%=data['attr_name']%>
			</td>
			<td>
			<%for(var j = 0;j < data['attrValue'].length;j++){
				var cont = data['attrValue'][j];%>
	    			<div class="stdbtn2" data-attr="<%=data['id']%>" data-attrname="<%=data['attr_name']%>" data-value="<%=cont['id']%>">
	        			<%=cont['attr_value']%>
	        		</div>
			<%}%>
			</td>
		</tr>
	<%}%>
	</table>
	<div class="rbtn">
        <span class="Kcancel2" style="margin-right:15px;">取消</span>
        <span class="Ksure2">确定</span>
    </div>
</script>
<script type="text/javascript" src="__PUBLIC__/Admin/js/webuploader.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Common/js/ajaxfileupload.js"></script>
<script charset="utf-8" src="__PUBLIC__/Admin/js/kindeditor/kindeditor.js"></script>
<!-- <script type="text/javascript" src="__PUBLIC__/Admin/js/kindeditor/kindeditor-min.js"></script> -->
<script type="text/javascript" src="__PUBLIC__/Admin/js/kindeditor/lang/zh_CN.js"></script>
<script type="text/javascript">
	/*使用模板引擎*/
    var bt = baidu.template;
	$("#goodsCategory").on('change','#childSelectCategory',function(){
		if( $("option:selected") ){
			loadCategoryAttr($(this).val());
		}
	});
	function loadCategoryAttr(category_id) {
			// $('#JeditSKU').hide();
			$.ajax({
				url: '{:U('Goods/categoryAttr')}',
				type: 'POST',
				dataType: 'json',
				async : false,
				data: {category_id:category_id}
			})
			.done(function(returnData) {
				// console.log(category_id);
				// console.log(returnData);
				if ( returnData['status'] == '200000' ) {
					attrData = returnData['data']['list'];
					var html = bt('attrData_tpl', returnData['data']);
					$('.Kreplay_m').html(html);
					// if ( attrData.length > 0 ) {
					// 	$("#JattrData").show();
					// }else{
					// 	$("#JattrData").hide();
					// }
				}
			});
		}
	/*********原来********/
	// var editor;
	// KindEditor.ready(function(K) {
	// 	editor = K.create('#description', {
	// 		height: "600px",
	// 		allowFileManager: true,
	// 		allowPreviewEmoticons : true, //true时显示浏览音频远程服务器按钮
	// 		autoSetDataMode : true,
	// 		filterMode : false,
	// 		uploadJson: '{:U("Goods/goodsUpload")}',
	// 		items : ['source','fontname','fontsize','forecolor','preview','selectall','justifyleft','justifycenter','justifyright','link','unlink','image','media'],
	// 		afterCreate : function() {
	// 			this.loadPlugin('autoheight');
	// 		}
	// 	});
	// });
	/*********原来********/
	/*********新视频********/
	KindEditor.options.filterMode = false;
	var editor;
	KindEditor.lang({
	     video:'视频',
	     audio:'音频',
	     imageico:'图片',
	});
	KindEditor.plugin('video', function(K) {
	    var editorobj = this, name = 'video';
	    // 点击图标时执行
	    editorobj.clickToolbar(name, function() {
	        var html = '<div class="givepop-box"> <div class="g-line">视频地址：<input type="text" name="" id="Jup_link" value="http://"><em id="Juploadnum"></em></div> <div class="g-line"><span class="stdbtn up-commit" id="upvideo" >选择视频上传</span> <span class="stdbtn Jtrue-commit"  >确定</span></div></div>'
	        popwin('插入视频',html);
	        upvideo();

	            // editorobj.insertHtml('你好');
	    });
	    $(document).on('click','.Jtrue-commit',function(){
	        var link = $('#Jup_link').val();
	        if(link == 'http://'){
	            alert('视频地址不能为空')
	        }else{
	            var videohtml = '<p><video src="'+link+'" controls="controls" width="100%" height="200px" style="background:#000"></video></p><br>'
	            editorobj.insertHtml(videohtml);
	            popclose()
	        }
	    })

	});
	KindEditor.plugin('audio', function(K) {
	    var editorobj = this, name = 'audio';
	    // 点击图标时执行
	    editorobj.clickToolbar(name, function() {
	        var html = '<div class="givepop-box"> <div class="g-line">音频地址：<input type="text" name="" id="Jup_link" value="http://"><em id="Juploadnum"></em></div> <div class="g-line"><span class="stdbtn up-commit" id="upvideo" >选择音频上传</span> <span class="stdbtn Jaudio-commit"  >确定</span></div></div>'
	        popwin('插入音频',html);
	        upvideo(2);

	            // editorobj.insertHtml('你好');
	    });
	    $(document).on('click','.Jaudio-commit',function(){
	        var link = $('#Jup_link').val();
	        if(link == 'http://'){
	            alert('音频地址不能为空')
	        }else{
	            var x = document.createElement("audio");
	            var lenNum = 0;
	            x.setAttribute("src",link);
	            x.addEventListener('canplay',function(){
	                lenNum = parseInt(x.duration);
	                var videohtml = '<p><span class="JaodioBox" style=" cursor: pointer; background:#a0e75a; display:block; position:relative; height:36px; width:40%; border-radius:4px; margin-left:12px;"><i class="Jlen">`'+lenNum+'`</i><em style="position:absolute; left:-14px; top:8px; border-width:8px; border-style:solid;border-color:transparent #a0e75a transparent transparent"></em><img src="__PUBLIC__/Shop/images/audio.png" alt="" style="height:30px; margin-top:2px; display:inline-block;width:auto" /><audio src="'+link+'" style="opacity:0;"></audio></span></p><br>'
	                editorobj.insertHtml(videohtml);
	                popclose()
	            })
	        }
	    })

	});
	KindEditor.ready(function(K) {
	    editor = K.create('#content', {
	        height:'600px',
	        minWidth:'360px',
	        resizeType : 1,
	        allowPreviewEmoticons : false,
	        allowImageUpload : true,
	        uploadJson : '{:U('Goods/goodsUpload')}',
	        allowFileManager : false,
	        items : [
	            'source', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
	            'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
	            'insertunorderedlist', '|','video','audio','image', 'link']
	    });
	});
	function upvideo(type = 1){
               if(type == 1){
                    //压缩文件初始化
                    var uploadfile = WebUploader.create({

                        // 选完文件后，是否自动上传。
                        auto: true,

                        // swf文件路径
                        swf: '__PUBLIC__/Admin/js/Uploader.swf',

                        // 文件接收服务端。
                        server: '{:U('Goods/Uploadfile')}',

                        // 选择文件的按钮。可选。
                        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                        pick: {id:'#upvideo',multiple:false},
                        fileNumLimit:1,
                        // 只允许选择文件。
                        accept: {
                            title: 'File',
                            extensions: 'mp4,rm,avi,mov,mpeg4,rmvb,mkv',
                            mimeTypes: 'file/*'
                        }
                    });
                
               }else{
                   //压缩文件初始化
                    var uploadfile = WebUploader.create({

                        // 选完文件后，是否自动上传。
                        auto: true,

                        // swf文件路径
                        swf: '__PUBLIC__/Admin/js/Uploader.swf',

                        // 文件接收服务端。
                        server: '{:U('Goods/Uploadfile')}',

                        // 选择文件的按钮。可选。
                        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                        pick: {id:'#upvideo',multiple:false},
                        fileNumLimit:1,
                        // 只允许选择文件。
                        accept: {
                            title: 'File',
                            extensions: 'mp3,wma,aac,wav,flac,ogg,ape',
                            mimeTypes: 'file/*'
                        }
                    });
               }
                // 当有文件添加不符合格式
                uploadfile.on( 'error', function(type) {
                    if(type =="Q_EXCEED_NUM_LIMIT"){
                            alert("超出限定数量！");
                    }
                    if(type =="F_DUPLICATE"){
                            alert("文件重复！");
                    }
                    if(type =="Q_TYPE_DENIED"){
                            alert("文件类型不正确");
                    }
                });
                // 当有压缩文件添加进来的时候
                uploadfile.on( 'fileQueued', function( file ) {
                    // $('.line-file-warp').show();
                    // $('#JfileName').text(file.name);
                    // $('.delect-btn').attr('data-id',file.id);

                });
                // 压缩文件上传过程中创建进度条实时显示。
                uploadfile.on( 'uploadProgress', function( file, percentage ) {
                    $('#Juploadnum').text(parseInt(percentage * 100)+'%');
                    // $('.file-msg-name .bg').css('width', percentage * 100 + '%' );
                });
                // 压缩文件上传失败，显示上传出错。
                uploadfile.on( 'uploadError', function( file ) {
                    alert('上传失败')
                    // $('.file-text').text('上传失败');
                });
                // 压缩文件上传成功。
                uploadfile.on( 'uploadSuccess', function( file,response ) {
                     $('#Juploadnum').text('上传成功');
                     $('#Jup_link').val(response.src);
                     uploadfile.removeFile(file.id);

                });
            
        }
	/*********新视频********/

	// 选择分类
	$('#selectCategory').on('change', function(){
		var pid = $(this).val();
		$.ajax({
			url: '{:U('Goods/getChildGoodsCategory')}',
			type: 'POST',
			dataType: 'json',
			data: {pid:pid}
		})
		.done(function(returnData) {
			if ( returnData['status'] == '200000' ) {
				$('#goodsCategory select').eq(1).remove();
				if ( returnData['data']['categoryData'].length ) {
					var categoryData = returnData['data']['categoryData'];
					var html = '<select id="childSelectCategory">';
					html += '<option value="">请选择</option>';
					for (var i = 0; i < categoryData.length; i++) {
						var data = categoryData[i];
						html += '<option value='+ data['id'] +'>'+ data['category_name'] +'</option>';
					}
					html += '</select>';
					$('#goodsCategory').append(html);
				}	
			}
		});
		$('#category_id').val(pid);
	});
	
	// 选择子类
	$('#goodsCategory').on('change', '#childSelectCategory', function(){
		$('#category_id').val($(this).val());
	});

	$('.Ksubmit').click(function() {
		editor.sync();
		$.ajax({
			url: '{:U('Goods/addGoods')}',
			type: 'POST',
			dataType: 'json',
			data: $('#KsubmitForm').serialize()
		})
		.done(function(returnData) {
			if ( returnData['status'] == '200000' ) {
				alert(returnData['message']);
				window.location.href = "{:U('Goods/goodsList')}";
			} else {
				alert(returnData['message']);
			}
		});
	});

	// 删除照片
	// $('#photoList').on('click', '.del-pic', function() {
	// 	$(this).parent().remove();
	// 	// uploader.getFiles('inited');
	// 	// uploader.removeFile(file,true);
	// });

	// 初始化图片 Uploader
	var uploader = WebUploader.create({
	    // 选完文件后，是否自动上传。
	    auto: true,

	    // swf文件路径
	    swf: '__PUBLIC__/Admin/js/Uploader.swf',

	    // 文件接收服务端。
	    server: '{:U('Goods/photoUpload')}',

	    // 选择文件的按钮。可选。
	    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
	    pick: '#filePicker',
	   	// fileSizeLimit:10240000, 

	    // 只允许选择图片文件。
	    accept: {
	        title: 'Images',
	        extensions: 'gif,jpg,jpeg,bmp,png',
	        mimeTypes: 'image/*'
	    }
	});

	// 当有图片文件添加进来的时候
	uploader.on('fileQueued', function( file ) {
	    var $li = $('<div id="' + file.id + '" class="pic-wrap">' + '<img>' +'<i class="del-pic"></i>'+ '<div class="up-status"><div class="runningbar"></div><em class="num">0%</em></div></div>'),
	        $img = $li.find('img');

	    // $list为容器jQuery实例
	    $('#photoList').append( $li );

	    // 创建缩略图
	    // 如果为非图片文件，可以不用调用此方法。
	    // thumbnailWidth x thumbnailHeight 为 100 x 100
	    uploader.makeThumb(file, function( error, src ) {
	        if ( error ) {
	            $li.find('.num').text('不能预览');
	            return;
	        }

	        $img.attr( 'src', src );
	    }, 162, 162 );

	    $('#photoList').on('click', '.del-pic', function() {
	    	$(this).parent().remove();
	    	uploader.removeFile(file,true);
	    });
	});

	// 图片文件上传过程中创建进度条实时显示。
	uploader.on('uploadProgress', function( file, percentage ) {
	    var $li = $( '#'+file.id ),
	        $percent = $li.find('.runningbar');
	        $li.find('.num').text(parseInt(percentage * 100) + '%');
	        $percent.css( 'width', percentage * 100 + '%' );
	});

	// 图片文件上传成功，给item添加成功class, 用样式标记上传成功。
	uploader.on('uploadSuccess', function( file, response ) {
	    var imagesInput = '<input type="hidden" name="images[]" value="'+ response.url +'" />';
	    $('#' + file.id).find('.del-pic').attr('data-src', response.url);
	    $('#' + file.id).append(imagesInput);
	});

	// 图片文件上传失败，显示上传出错。
	uploader.on('uploadError', function( file ) {
	    var $li = $('#' + file.id);
	    $li.find('.num').text('上传失败');
	});

	// 当有文件添加不符合格式
	uploader.on('error', function(type) {
	    if( type == 'Q_EXCEED_NUM_LIMIT' ){
			alert('超出限定数量');
		}
		if( type == 'F_DUPLICATE' ){
			alert('文件重复');
		}
		if( type == 'Q_TYPE_DENIED' ){
			alert("文件类型不正确");
		}
	});


	// sku上传图片
	$('#JeditSKU').on('change','.addinput',function(){
		var saveid = $(this).attr('id');
		$.ajaxFileUpload({
			url: "{:U('Goods/photoUpload')}",
			secureuri: false,
			fileElementId: saveid,
			dataType: 'json',
			success: function (data, status) {
				var oBgImg = $('#'+saveid).parents('.adddivs').find('.img-bg');
				var oaddinputbg = $('#'+saveid).parents('.adddivs').find('.addinput-bg');
				if( (oBgImg.find('img')).length==0 ){
					var str = oBgImg.html();
					var nowchangeImgId = $('#'+saveid).parents('.adddivs').attr('img-id');
					str = str + '<img src="" alt="" id="'+nowchangeImgId+'" width="50px" height="50px"/>';
					oBgImg.html(str);
					oBgImg.show();
					oaddinputbg.hide();
				}

				if (data.error == '') {
					$('#'+saveid).parents('.adddivs').find('img').attr('src',data.url);
					$('#'+saveid).parents('.adddivs').find("input[name='SKUimage[]']").attr('value',data.url);
					$('#'+saveid).parents('.adddivs').find('.img-bg').show();
					$('#'+saveid).parents('.adddivs').find('.addinput-bg').hide();
				}
			}
		})
	})

	// 删除sku图片
	$('#JeditSKU').on('click', '.Jcuteach-img', function(){
		var id = $(this).data('id');
		$(this).parent().hide();
		$('#image_' + id).attr('src', '');
		$('#Jupload_' + id).parent().show();
		$('#Jupload_' + id).parent().next('input').val('');
	})

	function createCombination() {
		var attrData = {};
		$('#KgoodsData').remove();
		$('.stdbtn2.on').each(function() {
			var attr = $(this).data('attr');
			var value = $(this).data('value');
			var value_name = $(this).text();
			var attr_name = $(this).data('attrname');

			if (!attrData[attr]) {
				attrData[attr] = {};
			}
			attrData[attr]['attr_name'] = attr_name;
			attrData[attr]['attr_list'] = attrData[attr]['attr_list'] ? attrData[attr]['attr_list'] : {};
			attrData[attr]['attr_list'][value] = value_name;
		});
		var attrStr = [];
		var attrList = [];
		var allAttr = [];
		var field = document.createElement('div');
		field.className = 'field';
		field.id = 'KgoodsData';
		attrStr.push('<table><tr><th>商品编码&nbsp;</th>');
		for(var i in attrData) {
			if (attrData.hasOwnProperty(i)) {
				attrStr.push('<th>' + attrData[i].attr_name + '</th>');
				attrList.push(i);
			}

			var len = allAttr.length
			allAttr[len] = [];
			for (var j in attrData[i].attr_list) {
				if (attrData[i].attr_list.hasOwnProperty(j)) {
					allAttr[len].push(attrData[i]['attr_list'][j] + '#' + i + '#' + j);
				}
			}
		}
		attrStr.push('<th>价格（元）&nbsp;</th> <th>库存&nbsp;</th>&nbsp;<th>图片</th></tr>');
		var combineResult = combine(allAttr);
		var goods_code = $('#goods_code').val();
		// console.log(combineResult);
		// console.log(combineResult);
		for (var j = 0; j < combineResult.length; j ++) {
			var tmp_list = combineResult[j].split('**');
			var multi_attr = ',',
				sku_id = '';
			// console.log(tmp_list);
			attrStr.push('<tr><td>'+ goods_code + j +'</td>');
			for (var k = 0; k < tmp_list.length; k ++) {
				var tmp_attr = tmp_list[k].split('#');
				// console.log(tmp_attr);
				attrStr.push('<td>' + tmp_attr[0] + '</td>');
				multi_attr += tmp_attr[2] + ',';
				sku_id += tmp_attr[2] + '-';
			}
			sku_id = sku_id.substring(0, sku_id.length - 1);
			attrStr.push('<td style="text-align:center;"><input name="SKUprice[]" type="text" id="JskuPrice_' + sku_id + '"/>&nbsp;<input type="hidden" name="SKUattr[]" value="' + multi_attr + '" /></td> <td  style="text-align:center;"><input type="text" id="JskuNumber_' + sku_id + '" name="SKUnumber[]"/>&nbsp;</td> <td><div id="divs_'+j+'" class="adddivs" img-id="image_'+j+'"><div class="img-bg" style="display:none;"><i class="cutIcon Jcuteach-img" data-id="'+j+'"></i><img src="" alt="" id="image_'+j+'" width="50px" height="50px"/></div><div class="addinput-bg"><input type="file" id="Jupload_'+j+'" name="fileToUpload" class="addinput"></div><input type="hidden" name="SKUimage[]" value=""></div></td> </tr>');
		}
		attrStr.push('</table>');
		field.innerHTML = attrStr.join('');
		var JeditSKU = document.getElementById('JeditSKU');
		JeditSKU.appendChild(field);
		JeditSKU.style.display = 'block';
	}
	
	// 排列组合
	function combine(arr) {
	    if(arr.length > 1) {
	        var len1 = arr[0].length, len2 = arr[1].length, newArr = arr.slice(0), temp = [];
	        for(var i = 0; i < len1; i ++) {
	            for(var j = 0; j < len2; j ++) {
	                temp.push(arr[0][i] + '**' + arr[1][j])
	            }
	        }
	        newArr.splice(0, 2, temp);
	        return arguments.callee(newArr)
	    }
	    return arr[0]
	}

	// 浅入浅出
	function maskFade(type) {
        (type == '1') ? $(".Kmask").fadeIn() : $(".Kmask").fadeOut();
        (type == '1') ? $(".Kreplay_m").fadeIn() : $(".Kreplay_m").fadeOut();
    }

	// 设置属性
	$('#Kattribute').click(function(){
		if ( !$('#goods_code').val() ) {
			alert('请输入商品编码');
			return;
		}
		if ( !$('#childSelectCategory').val() ) {
			alert('请选择具体的商品分类');
			return;
		}
		maskFade(1);
	});

	// 选择属性
	$(".Kreplay_m").on('click','.stdbtn2',function(){
		// alert(0);
		if ( $(this).hasClass('on') ) {
			$(this).removeClass('on');
		} else {
			$(this).addClass('on');
		}
	})
	$('.stdbtn2').click(function(){
		// alert(0);
		// if ( $(this).hasClass('on') ) {
		// 	$(this).removeClass('on');
		// } else {
		// 	$(this).addClass('on');
		// }
	});

	// 取消选择
	$(".Kreplay_m").on('click','.Kcancel2',function(){
		maskFade(0);
	})

	// 确定选择
	$(".Kreplay_m").on('click','.Ksure2',function(){
		maskFade(0);
		createCombination();
	})
</script>
</block>